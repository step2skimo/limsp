{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Assignment Overview (All Clients) | ISO 17025 Lab</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-4">
 <a href="{% url 'manager_dashboard' %}"
                       class="btn btn-sm btn-primary">
                      Back to Dashboard
                    </a>
  <h2>üóÇÔ∏è Assignment Overview (All Clients)</h2>
  <p class="text-muted">This page shows progress for all clients and lets you assign any samples.</p>

  {% for entry in client_data %}
    <div class="card mb-5">
      <div class="card-header bg-dark text-white">
        {{ entry.client.name }} ({{ entry.client.client_id }})
      </div>
      <div class="card-body">
        <h5>Test Parameter Assignment Progress</h5>
        {% if entry.parameters %}
          <table class="table table-striped mb-4">
            <thead>
              <tr>
                <th>Parameter</th>
                <th>Status</th>
                <th>Progress</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for param in entry.parameters %}
                {% with assigned=param.assigned_count %}

                <tr>
                  <td>{{ param.name }}</td>
                  <td>
                    {% if assigned == entry.total_samples %}
                      <span class="badge bg-success">‚úÖ Fully Assigned</span>
                    {% elif assigned > 0 %}
                      <span class="badge bg-warning text-dark">‚ö†Ô∏è Partial</span>
                    {% else %}
                      <span class="badge bg-danger">‚ùå Unassigned</span>
                    {% endif %}
                  </td>
                  <td>{{ assigned|default:0 }}/{{ entry.total_samples }} samples</td>
                  <td>
                    <a href="{% url 'assign_parameter_tests' entry.client.client_id param.id %}"
                       class="btn btn-sm btn-primary">
                      Assign Tests
                    </a>
                  </td>
                </tr>
                {% endwith %}
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="alert alert-secondary">No parameters found for this client.</div>
        {% endif %}

        <h5>Unassigned Samples</h5>
        {% if entry.unassigned_samples %}
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Sample Code</th>
                <th>Type</th>
                <th>Received</th>
                
              </tr>
            </thead>
            <tbody>
              {% for s in entry.unassigned_samples %}
                <tr>
                  <td>{{ s.sample_code }}</td>
                  <td>{{ s.sample_type }}</td>
                  <td>{{ s.received_date|date:"M d, Y" }}</td>
                  <td>
                   
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="alert alert-success">üéâ All samples assigned for this client.</div>
        {% endif %}
      </div>
    </div>
  {% endfor %}

</body>
</html>
