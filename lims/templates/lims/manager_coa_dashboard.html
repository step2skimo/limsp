{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>COA Manager Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .badge { margin-right: 0.4rem; }
    .table-sm td, .table-sm th { padding: 0.4rem; }
    .card-header strong { font-size: 1.05rem; }
    .card-body p { margin-bottom: 0.5rem; }
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
  </style>
</head>
<body>
<div class="container mt-5">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">ğŸ§¾ COA Manager Dashboard</h3>
    <div class="toggle-container">
      <label class="form-check-label" for="toggleMode">Table View</label>
      <input class="form-check-input" type="checkbox" id="toggleMode">
    </div>
  </div>

  {% if grouped_batches %}
    <!-- Card View -->
    <div id="previewMode">
      {% for client_id, sample_pairs in grouped_batches.items %}
        {% with sample_pairs.0.0 as client_name %}
        <div class="card mb-4 shadow-sm">
          <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <strong>{{ client_name }}</strong>
            <small class="text-muted">Client ID: {{ client_id }}</small>
          </div>
          <div class="card-body">
            <p><strong>Samples:</strong>
              {% for _, sample in sample_pairs %}
                <span class="badge bg-secondary">{{ sample.sample_code }}</span>
              {% endfor %}
            </p>
            <div class="d-flex gap-2 mt-2">
              <a href="{% url 'preview_coa' client_id=client_id %}" target="_blank" class="btn btn-outline-primary btn-sm">ğŸ‘ï¸ Preview</a>
              <a href="{% url 'generate_coa_pdf' client_id=client_id %}" class="btn btn-success btn-sm">â¬‡ï¸ Download PDF</a>
            </div>
          </div>
        </div>
        {% endwith %}
      {% endfor %}
    </div>

    <!-- Table View -->
    <div id="tableMode" style="display: none;">
      <div class="table-responsive">
        <table class="table table-striped table-bordered table-sm">
          <thead class="table-light">
            <tr>
              <th>Client</th>
              <th>Client ID</th>
              <th>Sample Code</th>
              <th>Preview</th>
              <th>PDF</th>
            </tr>
          </thead>
          <tbody>
            {% for client_id, sample_pairs in grouped_batches.items %}
              {% for client_name, sample in sample_pairs %}
              <tr>
                <td>{{ client_name }}</td>
                <td>{{ client_id }}</td>
                <td>{{ sample.sample_code }}</td>
                <td><a href="{% url 'preview_coa' client_id=client_id %}" target="_blank">ğŸ‘ï¸</a></td>
                <td><a href="{% url 'generate_coa_pdf' client_id=client_id %}">â¬‡ï¸</a></td>
              </tr>
              {% endfor %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="alert alert-warning text-center">
      ğŸš« No COA batches available to display.
    </div>
  {% endif %}

</div>

<script>
  const toggle = document.getElementById("toggleMode");
  toggle.addEventListener("change", () => {
    const cardView = document.getElementById("previewMode");
    const tableView = document.getElementById("tableMode");
    cardView.style.display = toggle.checked ? "none" : "block";
    tableView.style.display = toggle.checked ? "block" : "none";
  });
</script>
</body>
</html>
