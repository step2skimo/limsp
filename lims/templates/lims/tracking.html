<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>{{ organization }} â€“ Sample Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; background: #f9f9f9; }
    h2 { color: #2c3e50; margin-top: 40px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    th { background: #eaeaea; }
    .progress-bar { height: 12px; background: #ccc; border-radius: 4px; overflow: hidden; }
    .progress-fill { height: 100%; background: #27ae60; }
    .btn-download { background: #27ae60; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; }
    .badge-warning { background: #f39c12; color: white; padding: 4px 8px; border-radius: 4px; }
  </style>
</head>
<body>

  <h1>ðŸ“¦ Sample Tracker for {{ organization }}</h1>

  {% for block in client_data %}
    <h2>{{ block.client.name }} ({{ block.client.client_id }})</h2>

    {% if block.samples %}
      <table>
        <thead>
          <tr>
            <th>Sample Code</th>
            <th>Received</th>
            <th>Status</th>
            <th>Progress</th>
            <th>Turnaround (days)</th>
            <th>Parameters Tested</th>
          </tr>
        </thead>
        <tbody>
          {% for sample in block.samples %}
            <tr>
              <td>{{ sample.sample_code }}</td>
              <td>{{ sample.received_date }}</td>
              <td>{{ sample.get_status_display }}</td>
              <td>
                <div class="progress-bar">
                  <div class="progress-fill" style="width:{{ sample.progress }}%"></div>
                </div>
                <small>{{ sample.progress }}%</small>
              </td>
              <td>{{ sample.turnaround|default:"â€”" }}</td>
              <td>
                {% for a in sample.assignments %}
                  {{ a.parameter }} ({{ a.unit }}){% if not forloop.last %}, {% endif %}
                {% empty %}â€”{% endfor %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <br>
      {% if block.client.coa_released %}
        <a href="{% url 'generate_coa_pdf' block.client.client_id %}" class="btn-download">Download COA for {{ block.client.client_id }}</a>
      {% else %}
        <span class="badge-warning">COA Pending Release</span>
      {% endif %}

    {% else %}
      <p>No samples available for this client.</p>
    {% endif %}
    <hr>
  {% endfor %}

</body>
</html>
