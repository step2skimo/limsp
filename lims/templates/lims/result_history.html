<h2>ğŸ§¾ Submitted Results History</h2>

<form method="get" style="margin-bottom: 20px;">
  <input type="text" name="client_id" placeholder="Client ID" value="{{ filters.client_id }}">
  <input type="date" name="from" value="{{ filters.from }}">
  <input type="date" name="to" value="{{ filters.to }}">
  <button type="submit">ğŸ” Filter</button>
</form>

{% for client_id, param_map in page_obj %}
  <div style="margin-top: 30px;">
    <h3>ğŸ‘¤ Client ID: {{ client_id }}</h3>

    {% for parameter, tests in param_map.items %}
      <details style="margin-bottom: 1em;">
        <summary style="cursor: pointer;"><strong>ğŸ”¬ {{ parameter }}</strong> ({{ tests|length }})</summary>
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
          <thead>
            <tr style="background: #f0f0f0;">
              <th style="padding: 8px; border: 1px solid #ccc;">Sample</th>
              <th style="padding: 8px; border: 1px solid #ccc;">Result</th>
              <th style="padding: 8px; border: 1px solid #ccc;">TAT (days)</th>
              <th style="padding: 8px; border: 1px solid #ccc;">Duration</th>
              <th style="padding: 8px; border: 1px solid #ccc;">Recorded On</th>
            </tr>
          </thead>
          <tbody>
            {% for t in tests %}
              <tr>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ t.sample.sample_code }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">
                  {% if t.testresult %}{{ t.testresult.value }}{% else %}â€”{% endif %}
                </td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ t.turnaround_days|default:"â€”" }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">{{ t.duration|default:"â€”" }}</td>
                <td style="padding: 8px; border: 1px solid #ccc;">
                  {% if t.testresult and t.testresult.recorded_at %}
                    {{ t.testresult.recorded_at|date:"Y-m-d H:i" }}
                  {% else %}
                    â€”
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </details>
    {% endfor %}
  </div>
{% empty %}
  <p>No results submitted yet.</p>
{% endfor %}

<div style="margin-top: 20px;">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}&client_id={{ filters.client_id }}&from={{ filters.from }}&to={{ filters.to }}">â† Previous</a>
  {% endif %}

  <strong>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</strong>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&client_id={{ filters.client_id }}&from={{ filters.from }}&to={{ filters.to }}">Next â†’</a>
  {% endif %}
</div>
